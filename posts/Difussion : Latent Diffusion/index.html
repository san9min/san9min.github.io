<!DOCTYPE html>
<html lang="ko"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Sangmin Blog | Difussion : Latent Diffusion</title>
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
  <link rel="stylesheet" href="../../assets/styles/main.css">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <link rel="stylesheet"
     href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

</head><body>
  <main class="article">
    <h1>Difussion : Latent Diffusion</h1>
    <div class="meta">Feb 17, 2024 Â· 20 min read</div>
    <img class="hero" src="../../images/latentdiffusion.webp" alt="cover image">
    <h1><strong>High-Resolution Image Synthesis with Latent Diffusion Models</strong></h1>
<h2>Stable Diffusion</h2>
<p><a href="https://arxiv.org/abs/2112.10752">High-Resolution Image Synthesis with Latent Diffusion Models</a></p>
<p><a href="https://github.com/CompVis/stable-diffusion">https://github.com/CompVis/stable-diffusion</a></p>
<ul>
<li><code>Latent Diffusion Model</code></li>
<li><code>Cross-Attention based Conditioning</code></li>
<li><code>text to image</code></li>
</ul>
<p>pixcelì´ ì•„ë‹Œ latent spaceì—ì„œ diffusion modelì„ ëŒë ¤ì„œ computational costë¥¼ ë§ì´ ì¤„ì˜€ë‹¤. ê·¸ëŸ°ë° ë‚œ ì´ ëª¨ë¸ì´ ë” ë§¤ë ¥ì ì¸ ë¶€ë¶„ì€ cross attentionìœ¼ë¡œ generalí•œ conditioning inputì„ ë°›ëŠ”ë‹¤ëŠ” ì ì´ë‹¤. ì´ë¡œì¨ text ë¡œë„ gudienceë¥¼ ì¤„ ìˆ˜ ìˆë‹¤ëŠ” ì ì´ ë§¤ìš° ê°ë™ì´ì—ˆë‹¤..</p>
<h3>Guided Diffusion</h3>
<p>Stable Diffusionì„ ë³´ê¸°ì „ì— Guided Diffusionì´ ë¬´ì—‡ì¸ì§€ ì•Œì•„ì•¼í•œë‹¤. </p>
<p>Sampling processì— conditionì„ ì¤˜ì„œ generateë˜ëŠ” sampleë“¤ì„ ì¡°ì‘í•  ìˆ˜ ìˆë‹¤. ì¦‰ generationì„ guideí•œë‹¤. ì¦‰ prior data distribution p(x)ì— condition yë¥¼ ì¤˜ì„œ p(x|y)ê°€ ë˜ëŠ”ê²ƒì´ê³  conditional diffusionì€ ê° diffusion stepì— condition infoë¥¼ ë”í•´ì¤€ë‹¤ ìƒê°í•˜ë©´ ë˜ê³  ì´ë¡œì¨ imageë‚˜ textë¥¼ ë„£ì„ ìˆ˜ ìˆê²Œ ëœë‹¤. </p>
<p>$$
p_{\theta}(x_{0:T}|y) = p_{\theta}(x_T)\Pi_{t=1}^Tp_{\theta}(x_{t-1}|x_t,y)
$$</p>
<p>ì´ë ‡ê²Œ í•˜ë©´ ìš°ë¦¬ê°€ text yë¥¼ inputìœ¼ë¡œ ëª¨ë¸ì— ì¤„ ìˆ˜ ìˆë‹¤.</p>
<p>Diffusion modelì€ SDEë¡œ í‘œí˜„í•  ìˆ˜ ìˆê³  ê·¸ë˜ì„œ guided diffusion modelì€ $\nabla \log p_{\theta}(x_t|y)$ë¥¼ ë°°ìš°ê³ ì í•˜ê³  Bayes Ruleì— ì˜í•´</p>
<p>$$
\nabla_{x_t} \log p_{\theta}(x_t|y) = \nabla_{x_t} \log (\frac{p_{\theta}(y|x_t)p(x_t)}{p_{\theta}(y)}) \ = \nabla_{x_t} \log p_{\theta}(x_t) + \nabla_{x_t} \log p_{\theta}(y|x_t)
$$</p>
<p>ë¡œ ì •ë¦¬ ëœë‹¤. ì—¬ê¸°ì„œ guidance scalar termì„ ì¶”ê°€í•´ ì£¼ë©´</p>
<p><strong>Classifier guidance</strong></p>
<p>$$</p>
<p>\nabla_{x_t} \log p_{\theta}(x_t|y) =\nabla_{x_t} \log p_{\theta}(x_t) + \gamma \cdot\nabla_{x_t} \log p_{\theta}(y|x_t)
$$</p>
<p>ì´ ì‹ì˜ ë‘ë²ˆì§¸ í…€ì„ ë‹¤ì‹œ Bayes Ruleì„ ì¨ì„œ ì •ë¦¬í•˜ë©´</p>
<p><strong>Classifier Free guidance</strong></p>
<p><a href="https://arxiv.org/abs/2207.12598">Classifier-Free Diffusion Guidance</a></p>
<p>$$
\nabla_{x_t} \log p_{\theta}(x_t|y) = (1-\gamma)\nabla_{x_t} \log p_{\theta}(x_t) + \gamma \cdot\nabla_{x_t} \log p_{\theta}(x_t|y)
$$</p>
<p>â‡’  $\tilde{\epsilon}(z_\lambda,c) = (1+w)\epsilon_\theta(z_\lambda,c) - w\epsilon_\theta(z_\lambda)$</p>
<aside>
ğŸ’¡ unconditional termì€ 0ì„ embedding í•˜ëŠ” ë°©ì‹ ë“±ìœ¼ë¡œ ì²˜ë¦¬í•´ì„œ, `conditionalê³¼ unconditional ì„ ë™ì‹œì— í•™ìŠµ` (`í•˜ë‚˜ì˜ ëª¨ë¸`ë¡œ ì²˜ë¦¬ ê°€ëŠ¥)

</aside>

<p>Latent Diffusionì˜ conditioningì€  <code>Classifier free guidance</code></p>
<p>â­
$\epsilon_\theta(x_t,c) = s\epsilon_{cond}(x_t,c) + (1-s)\epsilon_{cond}(x_t,c_u)$</p>
<p>â­</p>
<p>ìœ¼ë¡œ formulateí•˜ê³  ì—¬ê¸°ì„œ $c_u$ëŠ” empty promptì— ëŒ€í•œ conditional embedding</p>
<h3>Architecture</h3>
<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ba36e87a-4856-43c6-96fc-b307cc9aa560/Untitled.png" alt="Untitled"></p>
<p><code>CLIP Text</code></p>
<ul>
<li>Text understanding component</li>
<li>for Text Encoding</li>
<li>Transformer language model</li>
</ul>
<p><code>U-Net</code> + <code>Scheduler</code></p>
<ul>
<li>Information creator</li>
<li>latent space â‡’ faster</li>
</ul>
<p><code>Autoencoder Decoder</code></p>
<ul>
<li>Image Decoder</li>
</ul>

    <section class="related">
        <div class="related-head">
          <h2>Related posts</h2>
          <a class="all-link" href="../../">Browse all articles&nbsp;â†’</a>
        </div>
        <div class="related-list">
      <a class="card mini" href="../../posts/Diffusion : DDIM/">
        <img class="thumb" src="../../images/post-002-thumb.jpg" alt="">
        <div class="card-body">
        
          <h3 class="card-title">Diffusion : DDIM</h3>
          <span class="arrow">â†—</span>
          <div class="meta">Feb 17, 2025 Â· 20 min</div>
        </div>
      </a>
      <a class="card mini" href="../../posts/Diffusion_DDPM/">
        <img class="thumb" src="../../images/Diffusion_DDPM/thumb.jpg" alt="">
        <div class="card-body">
        
          <h3 class="card-title">Diffusion : DDPM</h3>
          <span class="arrow">â†—</span>
          <div class="meta">Feb 17, 2023 Â· 20 min</div>
        </div>
      </a></div>
      </section> 
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <script>
    window.MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
      options: { linebreaks: { automatic: true, width: 'container' } }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <script src="../../assets/js/main.js" defer></script>
</body></html>